
generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int                @id @default(autoincrement())
  user_name          String             @unique
  email              String             @unique
  password           String
  CreadoEn           DateTime           @default(now()) @map("created_at")
  cart               Cart?
  roles              UserRole[]
  wish_list          Wish_List?
  reset_token        Reset_token?
  shipping_Addresses Shipping_Address[]
  orders             Order[] 
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String
  is_Deleted  Boolean
  users       UserRole[]
  permissions Permission[]
}

model UserRole {
  userId Int
  roleId Int

  user User @relation(fields: [userId], references: [id])
  role Role @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
}

model Permission {
  id    Int    @id @default(autoincrement())
  name  String
  roles Role[]
}

model Wish_List {
  id       Int       @id @default(autoincrement())
  id_user  Int?      @unique
  User     User?     @relation(fields: [id_user], references: [id])
  products Product[]
}

model Cart {
  id      Int        @id @default(autoincrement())
  id_user Int?       @unique
  usuario User?      @relation(fields: [id_user], references: [id])
  items   CartItem[]
}

model CartItem {
  id            Int     @id @default(autoincrement())
  units         Int
  unit_price    Decimal 
  offer_applied Decimal
  subtotal      Decimal 

  id_cart Int
  cart    Cart @relation(fields: [id_cart], references: [id], onDelete: Cascade)

  id_uniqueProduct Int
  uniqueProduct    Unique_Product @relation(fields: [id_uniqueProduct], references: [id])
}

model Product {
  id             Int              @id @default(autoincrement())
  name           String
  description    String
  is_deleted     Boolean          @default(false)
  offer          Decimal          @default(0)
  unit_price     Decimal          @default(0)
  categories     Category[]
  wish_list      Wish_List[]
  uniqueProducts Unique_Product[]
  images         ProductImage[]
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  url       String
  product   Product @relation(fields: [productId], references: [id])
  productId Int
}

model Unique_Product {
  id         Int         @id @default(autoincrement())
  name       String
  color      String
  is_deleted Boolean     @default(false)
  size       Size[]
  id_brand   Int?
  brand      Brand?      @relation(fields: [id_brand], references: [id])
  id_product Int?
  product    Product?    @relation(fields: [id_product], references: [id])
  orderItems OrderItem[]
  cartItems  CartItem[]
  stock      Stock?
}

model Size {
  id             Int              @id @default(autoincrement())
  size           String
  is_deleted     Boolean          @default(false)
  unique_product Unique_Product[]
}

model Brand {
  id                 Int              @id @default(autoincrement())
  name               String
  external_reference String
  is_deleted         Boolean          @default(false)
  unique_product     Unique_Product[]
}

model Stock {
  id                Int             @id @default(autoincrement())
  count             Int
  id_unique_product Int?            @unique
  product           Unique_Product? @relation(fields: [id_unique_product], references: [id])
}

model Category {
  id                 Int        @id @default(autoincrement())
  name               String
  products           Product[]
  is_deleted         Boolean    @default(false)
  id_category_parent Int?
  parent             Category?  @relation("CategoryToParent", fields: [id_category_parent], references: [id])
  children           Category[] @relation("CategoryToParent")
}

model Reset_token {
  id         Int      @id @default(autoincrement())
  token      String
  created_at DateTime
  used       Boolean
  id_user    Int?     @unique
  usuario    User?    @relation(fields: [id_user], references: [id])
}

model Shipping_Address {
  id      Int  @id @default(autoincrement())
  id_user Int
  usuario User @relation(fields: [id_user], references: [id])

  address_line_1 String
  address_line_2 String
  city           String
  postal_code    String
  country        String
  order          Order[]
}

model Shipment {
  id              Int             @id @default(autoincrement())
  tracking_number String
  status          String
  shipped_at      DateTime        @default(now())
  delivered_at    DateTime
  id_order        Int?            @unique
  order           Order?          @relation(fields: [id_order], references: [id])
  id_method       Int
  method          Shipping_Method @relation(fields: [id_method], references: [id])
}

model Shipping_Method {
  id                     Int        @id @default(autoincrement())
  name                   String
  provider               String
  stimated_delivery_time Int
  cost                   Decimal
  is_deleted             Boolean
  shipments              Shipment[]
}

model Order {
  id                  Int              @id @default(autoincrement())
  id_user             Int
  usuario             User             @relation(fields: [id_user], references: [id])
  id_shipping_address Int
  shipping_Address    Shipping_Address @relation(fields: [id_shipping_address], references: [id])
  items               OrderItem[]
  shipment            Shipment?
  id_detail           Int?             @unique
  detail              Detail?          @relation(fields: [id_detail], references: [id])
}

model OrderItem {
  id               Int            @id @default(autoincrement())
  units            Int
  unit_price       Decimal
  offer_applied    Decimal
  subtotal         Decimal
  id_order         Int
  order            Order          @relation(fields: [id_order], references: [id])
  id_uniqueProduct Int
  uniqueProduct    Unique_Product @relation(fields: [id_uniqueProduct], references: [id])
}

model Detail {
  id                  Int      @id @default(autoincrement())
  date_created        DateTime @default(now())
  date_approved       DateTime
  date_last_update    DateTime
  External_Reference  String
  operation_type      String
  transaction_ammount Decimal
  payment_status      String
  payment_method      String
  description         String
  order               Order?
}
